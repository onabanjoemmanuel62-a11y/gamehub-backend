<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Orders - Game Deals Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* === Admin Orders Dashboard Styling === */

.admin-wrapper {
  max-width: 1200px;
  margin: 40px auto;
  padding: 20px;
}

.admin-card {
  background: linear-gradient(135deg, rgba(20,20,40,0.95), rgba(10,10,20,0.9));
  border: 1px solid rgba(0,255,255,0.3);
  border-radius: 16px;
  box-shadow: 0 0 25px rgba(0,255,255,0.2), 0 0 50px rgba(255,0,255,0.1);
  backdrop-filter: blur(10px);
  overflow: hidden;
  animation: fadeIn 0.8s ease;
}

.admin-card h2 {
  padding: 16px;
  margin: 0;
  font-size: 20px;
  background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
  color: #000;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.admin-table thead th {
  background: rgba(0,0,0,0.6);
  color: var(--neon-blue);
  padding: 12px;
  text-align: left;
  border-bottom: 2px solid rgba(0,255,255,0.3);
}

.admin-table tbody td {
  padding: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  color: #eee;
}

.admin-table tbody tr:hover td {
  background: rgba(255,255,255,0.05);
  transition: background 0.3s ease;
}

/* Status badges */
.admin-status {
  font-weight: bold;
  padding: 6px 14px;
  border-radius: 20px;
  display: inline-block;
  font-size: 12px;
  letter-spacing: 0.5px;
}
.admin-status.Pending {
  background: rgba(255,255,0,0.15);
  border: 1px solid #ff0;
  color: #ff0;
}
.admin-status.Processing {
  background: rgba(0,128,255,0.15);
  border: 1px solid #0af;
  color: #0af;
}
.admin-status.Completed {
  background: rgba(0,255,0,0.15);
  border: 1px solid #0f0;
  color: #0f0;
}
.admin-status.Cancelled {
  background: rgba(255,0,0,0.15);
  border: 1px solid #f55;
  color: #f55;
}

/* Action buttons */
.admin-actions button {
  border: 2px solid var(--neon-blue);
  background: transparent;
  color: var(--neon-blue);
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-right: 6px;
}
.admin-actions button:hover {
  background: var(--neon-blue);
  color: #000;
  box-shadow: 0 0 15px var(--neon-blue), 0 0 30px var(--neon-pink);
}

  </style>
</head>
<body>
  <header>
    <h1>üì¶ Admin Orders Dashboard</h1>
    <nav>
      <a href="/index.html">üè† Storefront</a>
      <a href="/admin.html">‚öôÔ∏è Admin Panel</a>
      <a href="/logout">üö™ Logout</a>
    </nav>
  </header>

  <main>
    <table id="ordersTable">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Total</th>
          <th>Date</th>
          <th>Items</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="no-orders" class="no-orders" style="display:none;">
      No orders found.
    </div>
  </main>

  <script>
    async function loadOrders() {
      try {
        const res = await fetch('https://gamehub-backend-a0c2.onrender.com/orders', { credentials: 'include' });
        if (res.status === 403) {
          alert("Not authorized. Please log in as admin.");
          window.location.href = "/login.html";
          return;
        }
        const orders = await res.json();
        const tbody = document.querySelector("#ordersTable tbody");
        tbody.innerHTML = "";

        if (orders.length === 0) {
          document.getElementById("no-orders").style.display = "block";
          return;
        }

        orders.forEach(o => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${o.id}</td>
            <td>${o.name} <br/> (${o.email})</td>
            <td>$${o.total.toFixed(2)}</td>
            <td>${new Date(o.date).toLocaleString()}</td>
            <td>
              <ul>
                ${o.items.map(i => `<li>${i.name} √ó ${i.qty}</li>`).join("")}
              </ul>
            </td>
            <td>
              <select data-id="${o.id}">
                <option value="Pending" ${o.status === "Pending" ? "selected" : ""}>Pending</option>
                <option value="Processing" ${o.status === "Processing" ? "selected" : ""}>Processing</option>
                <option value="Shipped" ${o.status === "Shipped" ? "selected" : ""}>Shipped</option>
                <option value="Delivered" ${o.status === "Delivered" ? "selected" : ""}>Delivered</option>
                <option value="Cancelled" ${o.status === "Cancelled" ? "selected" : ""}>Cancelled</option>
              </select>
            </td>
          `;
          tbody.appendChild(tr);
        });

        // Attach change listeners
        document.querySelectorAll("select[data-id]").forEach(sel => {
          sel.addEventListener("change", async e => {
            const orderId = e.target.getAttribute("data-id"); // FIXED: Remove parseInt
            const status = e.target.value;
            
            try {
              const updateRes = await fetch("https://gamehub-backend-a0c2.onrender.com/update-order-status", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                credentials: "include",
                body: JSON.stringify({ orderId, status })
              });
              const data = await updateRes.json();
              if (data.success) {
                alert(`Order ${orderId} updated to ${status}`);
              } else {
                alert("Failed to update order status: " + (data.error || "Unknown error"));
              }
            } catch (err) {
              console.error("Update error:", err);
              alert("Network error while updating order");
            }
          });
        });
      } catch (err) {
        console.error("Error loading orders:", err);
        document.getElementById("no-orders").style.display = "block";
        document.getElementById("no-orders").textContent = "Error loading orders.";
      }
    }

    loadOrders();
  </script>
</body>
</html>